<div class="flex flex-col w-full h-screen p-6 rounded-lg bg-white">
  <!-- header -->
  <p class="text-2xl font-bold">
    Hey {{ (userService.getCurrentUser() | async)?.name || "there" }}!
  </p>
  <p class="text-lg">Create projects to streamline your workflows and ideas.</p>

  <!-- search bar/new project row -->
  <div class="flex gap-x-4 items-center my-5">
    <!-- search bar (disabled for now)-->
    <div class="flex-none relative w-1/2 h-9">
      <input
        class="border border-[#4F4F4F]/40 focus:outline-none text-sm pl-10 rounded-xl w-full h-full"
        placeholder="Search Projects..."
        (input)="projectService.setSearchFilter($any($event.target).value)"
      />
      <i
        class="material-icons absolute text-[#9E9E9E] left-2 top-[50%] translate-y-[-50%]"
        >search</i
      >
    </div>
    <!-- new project button -->
    <hlm-dialog class="ml-auto">
      <button
        hlmBtn
        brnDialogTrigger
        variant="secondary"
        class="gap-x-2"
        type="button"
      >
        <hlm-icon size="sm" name="lucidePlus" class="flex-none -ml-1.5" />
        New Project
      </button>
      <hlm-dialog-content *brnDialogContent="let ctx">
        <hlm-dialog-header>
          <div hlmDialogTitle>New Project</div>
        </hlm-dialog-header>
        <form
          id="projectForm"
          class="flex flex-col gap-y-3"
          [formGroup]="createProjectForm"
          (ngSubmit)="createProject()"
        >
          <input
            hlmInput
            size="sm"
            class="w-96"
            placeholder="Enter Project Name"
            formControlName="name"
          />
          <select
            class="border-2 border-[#038C7F] focus:outline-none rounded-md text-sm w-full p-2 pl-3"
            [ngClass]="{
              'text-[#C6CDE0]':
                createProjectForm.controls['language'].value === '',
              'text-black': createProjectForm.controls['language'].value !== '',
            }"
            formControlName="language"
          >
            <option value="" disabled selected>Select Language</option>
            <option class="text-black" value="Python">Python</option>
          </select>

          <brn-select class="inline-block" placeholder="Select an option">
            <hlm-select-trigger class="w-56">
              <hlm-select-value />
            </hlm-select-trigger>
            <hlm-select-content>
              <hlm-option value="Refresh">Refresh</hlm-option>
              <hlm-option value="Settings">Settings</hlm-option>
              <hlm-option value="Help">Help</hlm-option>
              <hlm-option value="Signout">Sign out</hlm-option>
            </hlm-select-content>
          </brn-select>

        </form>
        <hlm-dialog-footer>
          <button hlmBtn brnDialogClose variant="outline" size="sm">
            Cancel
          </button>
          <button
            hlmBtn
            brnDialogClose
            variant="secondary"
            size="sm"
            (click)="(null)"
          >
            Create
          </button>
        </hlm-dialog-footer>
      </hlm-dialog-content>
    </hlm-dialog>
  </div>

  <!-- project directory table -->
  <div class="overflow-y-auto w-full">
    <table class="table-fixed text-left text-sm w-full">
      <!-- table header + sorting buttons -->
      <thead>
        <tr>
          <!-- weird CSS workaround to make the body scrollable. reference:
        https://www.geeksforgeeks.org/how-to-create-a-table-with-fixed-header-and-scrollable-body/#. maybe i should've just used flex columns... -->
          <!-- project name header -->
          <th class="sticky top-0 rounded-ss-lg bg-[#F1F1F1] px-4 py-3 w-[30%]">
            <div class="flex items-center justify-between">
              Project Name
              <!-- <button
              class="material-icons-outlined text-[#9E9E9E]"
              type="button"
              (click)="(null)"
            >
              unfold_more
            </button> -->
            </div>
          </th>
          <!-- last modified header -->
          <th class="sticky top-0 bg-[#F1F1F1] pr-4">
            <div class="flex items-center justify-between">
              Last Modified
              <!-- <button
              class="material-icons-outlined text-[#9E9E9E]"
              type="button"
              (click)="(null)"
            >
              unfold_more
            </button> -->
            </div>
          </th>
          <!-- actions header -->
          <th
            class="sticky top-0 rounded-se-lg bg-[#F1F1F1] text-center px-4 w-[15%]"
          >
            Actions
          </th>
        </tr>
      </thead>
      <!-- project rows -->
      <tbody>
        <!-- display projects -->
        @for (project of this.projects; track project.id) {
          <tr class="bg-white hover:brightness-90">
            <td
              class="px-4 truncate py-1.5 cursor-pointer"
              (click)="goToWorkspace(project)"
            >
              <i class="material-symbols-outlined align-middle pr-1">
                folder_open
              </i>
              {{ project.name }}
            </td>
            <td class="pr-4 truncate">
              {{ project.updatedAt.toLocaleDateString("en-US") }}
            </td>
            <td class="text-[#4F4F4F] overflow-hidden text-center">
              <button
                class="material-symbols-outlined align-middle"
                type="button"
                (click)="projectService.deleteProject(project)"
              >
                delete
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  @if (projects?.length === 0) {
    <div class="flex flex-col mt-auto items-center gap-y-1">
      <img class="w-12 h-12" src="assets/twocube-logo-black-bg.png" />
      <p class="font-bold">No Projects Yet</p>
      <p>Use the "New Project" button to get started.</p>
    </div>
  }

  <!-- bottom page navigator -->
  <div class="mt-auto flex gap-x-4 justify-center items-center pr-6">
    <button
      class="text-[#9E9E9E] text-sm"
      type="button"
      (click)="projectService.setPageNumber(pageNumber - 1)"
      [disabled]="pageNumber === 1"
    >
      Previous
    </button>

    <!-- 2 pages back number -->
    @if (pageNumber === totalPages && pageNumber > 2) {
      <button
        class="bg-[#E0E0E0] hover:brightness-90 rounded-xl h-10 w-10"
        type="button"
        (click)="projectService.setPageNumber(pageNumber - 2)"
      >
        {{ pageNumber - 2 }}
      </button>
    }
    <!-- previous page number -->
    @if (pageNumber !== 1) {
      <button
        class="bg-[#E0E0E0] hover:brightness-90 rounded-xl h-10 w-10"
        type="button"
        (click)="projectService.setPageNumber(pageNumber - 1)"
      >
        {{ pageNumber - 1 }}
      </button>
    }
    <!-- current page -->
    <button class="bg-[#024050] text-white rounded-xl h-10 w-10">
      {{ pageNumber }}
    </button>
    <!-- next page -->
    @if (pageNumber !== totalPages) {
      <button
        class="bg-[#E0E0E0] hover:brightness-90 rounded-xl h-10 w-10"
        type="button"
        (click)="projectService.setPageNumber(pageNumber + 1)"
      >
        {{ pageNumber + 1 }}
      </button>
    }
    <!-- 2 pages forward -->
    @if (pageNumber === 1 && totalPages > 2) {
      <button
        class="bg-[#E0E0E0] hover:brightness-90 rounded-xl h-10 w-10"
        type="button"
        (click)="projectService.setPageNumber(pageNumber + 2)"
      >
        {{ pageNumber + 2 }}
      </button>
    }

    <button
      class="text-[#9E9E9E] text-sm"
      type="button"
      (click)="projectService.setPageNumber(pageNumber + 1)"
      [disabled]="pageNumber === totalPages"
    >
      Next
    </button>
  </div>

  <!-- create project dialog -->
  <dialog
    #createProjectDialog
    class="z-[100] w-1/3 bg-white rounded-lg border border-[#D0D2E0] outline-none"
  >
    <div class="flex flex-col">
      <!-- header and close button -->
      <div class="flex items-center p-5 pb-3">
        <p class="font-medium text-[#191E50]">New Project</p>
        <button
          class="material-icons-outlined text-[#8A8EB1] ml-auto"
          type="button"
          (click)="createProjectDialog.close()"
        >
          close
        </button>
      </div>
      <hr class="w-full text-[#D0D2E0]" />
      <!-- input buttons -->
      <form
        id="projectForm"
        class="flex flex-col gap-y-3 w-5/6 p-4"
        [formGroup]="createProjectForm"
        (ngSubmit)="createProject(); createProjectDialog.close()"
      >
        <!-- create project name input -->
        <input
          class="border-2 border-[#038C7F] focus:outline-none rounded-md text-sm placeholder-[#C6CDE0] w-full p-2 pl-3"
          placeholder="Enter Project Name"
          formControlName="name"
        />
        <!-- create project language select -->
        <select
          class="border-2 border-[#038C7F] focus:outline-none rounded-md text-sm w-full p-2 pl-3"
          [ngClass]="{
            'text-[#C6CDE0]':
              createProjectForm.controls['language'].value === '',
            'text-black': createProjectForm.controls['language'].value !== '',
          }"
          formControlName="language"
        >
          <option value="" disabled selected>Select Language</option>
          <option class="text-black" value="Python">Python</option>
        </select>
        <!-- create project model select -->
        <select
          class="border-2 border-[#038C7F] focus:outline-none rounded-md text-sm w-full p-2 pl-3"
          [ngClass]="{
            'text-[#C6CDE0]': createProjectForm.controls['model'].value === '',
            'text-black': createProjectForm.controls['model'].value !== '',
          }"
          formControlName="model"
        >
          <option value="" disabled selected>Select Model</option>
          <option class="text-black" value="GPT-4o">GPT-4o</option>
        </select>
      </form>
      <hr class="w-full text-[#D0D2E0]" />
      <!-- cancel/create buttons -->
      <div class="flex gap-x-2 p-3">
        <button
          class="ml-auto text-sm font-medium px-6 py-2 bg-[#1F9254]/10 rounded-lg hover:brightness-90 tracking-wide"
          type="button"
          (click)="createProjectDialog.close()"
        >
          Cancel
        </button>
        <button
          class="text-sm font-medium px-6 py-2 bg-[#038C7F] rounded-lg text-white tracking-wide"
          [ngClass]="{
            'hover:brightness-90': createProjectForm.valid,
          }"
          type="submit"
          form="projectForm"
          [disabled]="!createProjectForm.valid"
        >
          Create
        </button>
      </div>
    </div>
  </dialog>
</div>
